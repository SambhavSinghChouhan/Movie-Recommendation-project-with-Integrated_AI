<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile - RECOMMENDO</title>
<style>
  body {margin:0;font-family:Arial,sans-serif;background:#0f1724;color:#fff;}
  .container {max-width:1100px;margin:20px auto;padding:0 16px;}
  .user-header {text-align:center;margin-bottom:30px;}
  .user-header h1 {font-size:36px;margin:0;color:#ffd36b;}
  .user-header p {font-size:16px;color:#9aa4b2;margin:4px 0;}
  .section {margin-bottom:30px;}
  .section h2 {font-size:20px;margin-bottom:12px;color:#ffd36b;}
  .movies-row {display:flex;overflow-x:auto;gap:12px;padding-bottom:8px;}
  .movie-card {min-width:200px;height:300px;flex-shrink:0;background:rgba(255,255,255,0.03);border-radius:10px;overflow:hidden;cursor:pointer;transition:transform 0.2s;}
  .movie-card img {width:100%;height:100%;object-fit:cover;}
  .movie-card:hover {transform:scale(1.05);}
</style>
</head>
<body>

<div class="container">
  <div class="user-header">
    <h1 id="username">Loading...</h1>
    <p id="email"></p>
  </div>

  <div class="section">
    <h2>Watchlist</h2>
    <div class="movies-row" id="watchlist"></div>
  </div>

  <div class="section">
    <h2>Favourites</h2>
    <div class="movies-row" id="favourites"></div>
  </div>

  <div class="section">
    <h2>Watched</h2>
    <div class="movies-row" id="watched"></div>
  </div>
</div>

<script>
async function loadProfile() {
  try {
    const res = await fetch('profilepage.php', { credentials: 'same-origin' });
    const data = await res.json();

    if(data.error) {
      document.getElementById('username').textContent = "Guest User";
      document.getElementById('email').textContent = data.error;
      return;
    }

    document.getElementById('username').textContent = data.user.User_name;
    document.getElementById('email').textContent = data.user.email;

    function renderMovies(sectionId, movies) {
      const container = document.getElementById(sectionId);
      container.innerHTML = movies.map(m => `
        <div class="movie-card" onclick="location.href='moviepage.html?id=${m.movie_id}'">
          <img src="${m.Template_poster_url}" alt="${m.title}">
        </div>
      `).join('');
    }

    renderMovies('watchlist', data.watchlist);
    renderMovies('favourites', data.favourites);
    renderMovies('watched', data.watched);

  } catch(err) {
    console.error(err);
    document.getElementById('username').textContent = "Guest User";
    document.getElementById('email').textContent = "Failed to load profile";
  }
}

// Load profile on page load
loadProfile();
</script>

</body>
</html>
